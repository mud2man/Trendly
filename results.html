<!doctype html>
<html lang="en">
  <head>
    <title>Trendly</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/main.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Pacifico" rel="stylesheet">

    <!-- Codebird -->
    <script type="text/javascript" src="assets/codebird.js"></script>
  </head>
  <body>

    <div class="container">
      <div class="row">
        <div class="col-lg-2 col-md-12">
          <div class='text-center title-small brand'>
            Trendly
          </div>
        </div>
        <div class='col-lg-10 col-md-12'>
          <br />
          <form action="results.html">
            <div class="form-group">
              <input type="text" class="form-control text-center" id="queryInput-results"  name='q' placeholder="What would you like to know about?">
            </div>
          </form>
        </div>
      </div>
      <br />
      <nav class="nav nav-pills nav-fill">
        <a class="nav-item nav-link active" href="#">Sentiment</a>
        <a class="nav-item nav-link" href="#">Geography</a>
        <a class="nav-item nav-link" href="#">Charts</a>
        <a class="nav-item nav-link" href="#">Something Else</a>
      </nav>
      <div class="row">

        <div id="tweets">
          <!-- tweets go here -->
        </div>
      </div>
    </div>

    



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

    <!-- Twitter stuff -->
    <script sync src="https://platform.twitter.com/widgets.js"></script>


    <!-- More Codebird -->
    <script type="text/javascript">
      // https://www.sitepoint.com/url-parameters-jquery/
      $.urlParam = function(name){
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        return results[1] || 0;
      }
      var query = $.urlParam("q");
      $('#queryInput-results').val(decodeURIComponent($.urlParam("q").replace(/\+/, " ")));
      var cb = new Codebird;
      cb.setConsumerKey("nDuDRuXVkv3N3GrJiTXm5cXtH", "nnqF5HGuyOURRe2fkcUZpVMTwdGS5xecfQIZvDr5GM2is8PsPr");
      var params = {
        q: query,
        geocode: "40.808127,-73.965864,5mi",
        count: 100,
        lang: 'en'
      };
      cb.__call(
          "search_tweets",
          params,
          function (reply) {
            console.log(reply);
            var to_get = [];
            var sentiment_params = {};
            sentiment_params["lang"] = "en";
            sentiment_params["data"] = [];
            reply["statuses"].forEach(function(e) {
              to_get.push({id: e["id_str"], user: e["user"]["screen_name"]});
              sentiment_params["data"].push({id: e["id_str"], text: e["text"], query: decodeURIComponent(query.replace(/\+/, " "))});
            });
            // for (var i = 0; i < to_get.length; ++i) {
            //   e = to_get[i];
            //   $('#tweets').append('<div id="tweet' + e['id'] + '"></div>');
            //   var tweet = document.getElementById("tweet" + e['id']);
            //   var id = e['id'];

            //   twttr.widgets.createTweet(
            //     id, tweet, 
            //     {
            //       conversation : 'none',    // or all
            //       cards        : 'hidden',  // or visible 
            //       linkColor:     '#f9953e',
            //       theme        : 'light',    // or dark
            //       width: 400
            //     })
            //   .then (function (el) {
            //     //
            //   });
            // }
            var cors_api_url = 'http://cors-anywhere.herokuapp.com/';
            function doCORSRequest(options, printResult) {
              var x = new XMLHttpRequest();
              x.open(options.method, cors_api_url + options.url);
              x.onload = x.onerror = function() {
                printResult(
                  options.method + ' ' + options.url + '\n' +
                  x.status + ' ' + x.statusText + '\n\n' +
                  (x.responseText || '')
                );
              };
              if (/^POST/i.test(options.method)) {
                x.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
              }
              x.send(options.data);
            }

            doCORSRequest({
              method: 'POST',
              url: 'http://www.sentiment140.com/api/bulkClassifyJson?appid=alekrzieba@gmail.com',
              data: sentiment_params
            }, function printResult(result) {
              console.log(result);
            });
          }
      );
      


</script>

  </body>
</html>